Задача.

Есть веб-api, непрерывно принимающее события (ограничимся 10000 событий) для группы аккаунтов (1000 аккаунтов) и складывающее их в очередь.
Каждое событие связано с определенным аккаунтом и важно, чтобы события аккаунта обрабатывались в том же порядке, в котором поступили в очередь.
Обработка события занимает 1 секунду (эмулировать с помощью sleep).

Веб-api и очередь эмулировать консольным скриптом, непрерывно генерирующим события для обработки в фоне. События генерировать пачками, содержащими последовательности по 1-10 для каждого аккаунта.
Сделать обработку очереди событий максимально быстрой на данной конкретной машине.

Решение.

Разделим задачу на 2 части. 

1. В папке generator лежит часть, которая генерирует нам элементы очереди(таски) и пишет их в сокет по адресу 127.0.0.1:8081
Изменять количество задач и количество аккаунтов можно с помощью параметров командной строки --task-number=10000 и --account-number=1000
10000 и 1000 параметры по умолчанию.

2. В папке worker лежит часть, которая читает задачи из сокета по адресу 127.0.0.1:8081. Таск состоит из двух чисел - это номер аккаунта и номер сообщения.
У каждого аккаунта сообщения нумеруются начиная с 1, сами аккаунты нумеруются с 0.
Мы проверяем есть ли в мапе канал с номером текущего аккаунта, если нет, то запускаем горутину(воркер) и создаем буферизированный канал, с которого эта горутина будет читать таски. Привязываем этот канал к аккаунту с помощью нашей мапы. Пишем задачу в необходимый канал. Так как канал буферизированный то блокировки на запись в канал должны случаться крайне редко.


Для проведения теста, нужно для начала запустить генератор командой go run generator/main.go, затем в отдельном окне терминала запустить команду go run worker/main.go

Если у вас на машине нет компилятора Go, то можно запускать бинарники, которые лежат в папках generator и worker.


